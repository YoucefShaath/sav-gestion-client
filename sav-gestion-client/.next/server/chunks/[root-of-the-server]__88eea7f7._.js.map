{"version":3,"sources":["../../../../sav-gestion-client/src/lib/mail.js"],"sourcesContent":["import nodemailer from \"nodemailer\";\r\n\r\nlet transporter;\r\n\r\nfunction getTransporter() {\r\n  if (!transporter) {\r\n    transporter = nodemailer.createTransport({\r\n      host: process.env.SMTP_HOST || \"smtp.gmail.com\",\r\n      port: parseInt(process.env.SMTP_PORT || \"587\"),\r\n      secure: process.env.SMTP_SECURE === \"true\",\r\n      auth: {\r\n        user: process.env.SMTP_USER,\r\n        pass: process.env.SMTP_PASS,\r\n      },\r\n    });\r\n  }\r\n  return transporter;\r\n}\r\n\r\nexport async function sendMail({ to, subject, html, attachments } = {}) {\r\n  // Dev fallback: if SMTP not configured, don't fail — simulate success so local testing works.\r\n  if (\r\n    process.env.NODE_ENV !== \"production\" &&\r\n    (!process.env.SMTP_USER || !process.env.SMTP_PASS)\r\n  ) {\r\n    console.warn(\"SMTP not configured — skipping send (dev fallback)\");\r\n    console.log(\"Email to:\", to, \"subject:\", subject);\r\n    if (attachments)\r\n      console.log(\r\n        \"Attachments:\",\r\n        attachments.map((a) => a.filename),\r\n      );\r\n    return { success: true, simulated: true };\r\n  }\r\n\r\n  const t = getTransporter();\r\n  try {\r\n    const mailOptions = {\r\n      from: `\"Informatica SAV\" <${process.env.SMTP_USER || \"noreply@informaticacompany.com\"}>`,\r\n      to,\r\n      subject,\r\n      html,\r\n    };\r\n    if (attachments) mailOptions.attachments = attachments;\r\n\r\n    const info = await t.sendMail(mailOptions);\r\n    return { success: true, messageId: info.messageId };\r\n  } catch (err) {\r\n    console.error(\"Email send error:\", err);\r\n    return { success: false, error: err.message };\r\n  }\r\n}\r\n"],"names":[],"mappings":"21CAEI,EAFJ,IAAA,EAAA,EAAA,CAAA,CAAA,OAmBO,eAAe,EAAS,IAAE,CAAE,SAAE,CAAO,CAAE,MAAI,aAAE,CAAW,CAAE,CAAG,CAAC,CAAC,EAgBpE,IAAM,GA9BF,AAAC,CA8BK,GA7BR,EAAc,EAAA,KADE,EACQ,CAAC,eAAe,CAAC,CACvC,KAAM,QAAQ,GAAG,CAAC,SAAS,EAAI,iBAC/B,KAAM,SAAS,QAAQ,GAAG,CAAC,SAAS,EAAI,OACxC,OAAoC,SAA5B,QAAQ,GAAG,CAAC,WAAW,CAC/B,KAAM,CACJ,KAAM,QAAQ,GAAG,CAAC,SAAS,CAC3B,KAAM,QAAQ,GAAG,CAAC,SAAS,AAC7B,CACF,EAAA,EAEK,GAoBP,GAAI,CACF,IAAM,EAAc,CAClB,KAAM,CAAC,mBAAmB,EAAE,QAAQ,GAAG,CAAC,SAAS,EAAI,iCAAiC,CAAC,CAAC,IACxF,UACA,OACA,CACF,EACI,IAAa,EAAY,WAAW,CAAG,CAAA,EAE3C,IAAM,EAAO,MAAM,EAAE,QAAQ,CAAC,GAC9B,MAAO,CAAE,SAAS,EAAM,UAAW,EAAK,SAAS,AAAC,CACpD,CAAE,MAAO,EAAK,CAEZ,OADA,QAAQ,KAAK,CAAC,oBAAqB,GAC5B,CAAE,SAAS,EAAO,MAAO,EAAI,OAAO,AAAC,CAC9C,CACF"}